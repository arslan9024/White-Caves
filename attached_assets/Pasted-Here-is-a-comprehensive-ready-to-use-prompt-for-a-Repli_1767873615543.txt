Here is a comprehensive, ready-to-use prompt for a Replit AI agent to upgrade your MERN stack application's authentication, dashboard, and deployment pipeline.

### **MERN Stack Application Upgrade: Production Enhancement Plan**

**Objective**: You are tasked with upgrading a MERN (MongoDB, Express, React, Node.js) application to production standards. The primary goals are to fix authentication and build errors on Vercel, enhance dashboard features with React and Redux, implement comprehensive testing, establish a CI/CD pipeline, and enforce a secure environment management strategy.

---

### **Phase 1: Build, Deployment & Authentication Fixes**

**A. Resolve Vercel Build/Deploy Auth Errors**
1.  **Environment Variables**: Audit all environment variables required for both frontend (React) and backend (Express) on Vercel. Ensure secrets (MongoDB URI, JWT keys, OAuth credentials) are only in the backend project settings, while public API URLs are in the frontend.
2.  **Configure Vercel Authentication**: Enable "Vercel Authentication" for the project's preview deployments to protect development builds. Configure access for team members and note this can be bypassed with shareable links for testing.
3.  **CORS Configuration**: Verify the Express server's CORS settings are correctly configured for the production frontend URL, not just `localhost`.
4.  **Serverless Function Configuration**: Ensure the Express server is correctly adapted for Vercel's serverless environment (e.g., using `module.exports = app;` instead of `app.listen()` unless necessary).

**B. Enhance Existing Authentication**
1.  **Session & State Management**: Integrate the current Redux store with the auth flow. The Redux state should hold the user session, derived from a secure HTTP-only cookie or a stored token.
2.  **Strengthen Security**:
    *   Implement rate limiting on login/registration endpoints.
    *   Add input validation and sanitization for all auth routes.
    *   Ensure JWT tokens have appropriate expiry and are refreshed securely.
3.  **User Experience**: Add clear loading states, error messages, and protected route components that redirect unauthenticated users.

---

### **Phase 2: Dashboard & CRUD Enhancement with React/Redux**

**A. Upgrade State Management**
1.  **Adopt Redux Toolkit (RTK)**: Migrate the existing Redux logic to Redux Toolkit for simpler, less verbose code and best practices.
2.  **Implement RTK Query**: Replace manual `axios` or `fetch` calls with RTK Query for automatic data fetching, caching, synchronization, and mutation management. This will form the core API layer for all dashboard CRUD operations.

**B. Build Reusable Dashboard Architecture**
1.  **Create a Central API Slice**: Define endpoints for all resources (users, posts, etc.) using RTK Query.
2.  **Develop Generic CRUD Components**: Build reusable components (`DataTable`, `FormModal`, `DeleteConfirmation`) that connect to the RTK Query hooks.
3.  **Structure Dashboard Layout**: Create a responsive layout with a sidebar, header, and main content area. Use React Router for navigation between different dashboard views (e.g., User Management, Analytics).

---

### **Phase 3: Testing, CI/CD & Environment Strategy**

**A. Implement Comprehensive Testing**
1.  **Frontend (React)**: Use Jest and React Testing Library. Write unit tests for components, integration tests for Redux slices, and hooks.
2.  **Backend (Node.js/Express)**: Use Jest or Mocha/Chai. Write unit tests for API controllers/services and integration tests for critical API routes.
3.  **End-to-End (E2E)**: Configure a tool like Cypress or Playwright to test critical user flows (login, dashboard navigation, a key CRUD operation).

**B. Establish CI/CD Pipeline with GitHub Actions & Vercel**
1.  **Pipeline Design**: Set up a GitHub Actions workflow that triggers on all pushes and pull requests.
2.  **Workflow Steps**:
    *   **Checkout Code**
    *   **Set Up Node.js**
    *   **Install Dependencies** for both frontend and backend.
    *   **Run Test Suites**: Execute frontend, backend, and E2E tests. The build should fail if any test fails.
    *   **Deploy to Vercel**: On successful merge to the main branch, automatically deploy to production using the Vercel CLI.
3.  **Secrets Management**: Store `VERCEL_TOKEN`, `VERCEL_PROJECT_ID`, `VERCEL_ORG_ID`, and all other environment secrets in GitHub Actions' "Secrets and Variables" section. The workflow will inject these during deployment.

**C. Environment Management Strategy**
1.  **Three-Tier Structure**: Maintain clear separation between **Development**, **Preview/Staging**, and **Production** environments.
2.  **Configuration per Environment**: Use separate `.env` files locally and corresponding environment variable projects in Vercel and GitHub Actions for each tier.
3.  **Branch Mapping**: Connect Git branches to environments (e.g., `main` -> Production, `develop` -> Staging, feature branches -> Preview Deploys).

---

### **Deliverables & Acceptance Criteria**

*   A **stable production deployment on Vercel** with no authentication or CORS errors.
*   An **enhanced dashboard** where all user-related data can be managed (Create, Read, Update, Delete) through a unified, Redux-powered interface.
*   A **fully implemented test suite** with passing unit, integration, and E2E tests.
*   A **working CI/CD pipeline** in GitHub Actions that automatically runs tests and deploys to Vercel.
*   **Documentation** covering the new environment strategy, how to run tests locally, and the updated deployment process.

### **Strategic Considerations for Implementation**

*   **Prioritization**: Begin with fixing the Vercel build errors (Phase 1A) to unblock deployment, then move to CI/CD (Phase 3) to safeguard quality, before major refactoring.
*   **Incremental Rollout**: Upgrade the Redux store and one dashboard CRUD section at a time to minimize risk.
*   **Tool Recommendation**: The `@reduxjs/toolkit` and `react-redux` libraries are essential for the state management upgrade.

**Ready to proceed. Please confirm the current project structure and share specific Vercel build error logs for immediate troubleshooting.**